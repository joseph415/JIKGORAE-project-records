# ğŸ³ JIKGORAE-Project-records
#### ë³¸ ì €ì¥ì†Œì˜ ëª©ì ì€ [ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ íŒ€ í”„ë¡œì íŠ¸](https://github.com/woowacourse-teams) ë¥¼ ì§„í–‰í•˜ë©´ì„œ í–ˆë˜ ë‚´ìš©ë“¤ì„ ì •ë¦¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.  

## ì§ê³ ë˜ 
ë‹¹ì‹ ì´ ì†í•œ ê·¸ë£¹ ì–´ë””ë“  ë‹¹ì‹ ì´ ì›í•˜ëŠ” ê²ƒì„ ì‚¬ê³  íŒŒì„¸ìš”. ì¡°ì§ ì¤‘ê³  ê±°ë˜, ì§ê³ ë˜ ğŸ³

> ë”°ëœ»í•œ êµë¥˜ê°€ ìˆëŠ” ì¡°ì§ ë²¼ë£©ì‹œì¥ì„ ê¿ˆê¾¸ë‹¤

- [ì§ê³ ë˜ Github](https://github.com/woowacourse-teams/2020-seller-lee-company)
- [ì§ê³ ë˜ ì†Œê°œ](https://sites.google.com/woowahan.com/wooteco-demo/ì§ê³ ë˜/)

## ê¸°ìˆ  ìŠ¤íƒ
![stack](images/stack.png)

## íŒ¨í‚¤ì§€ êµ¬ì¡°
```gherkin
api
  â”œâ”€â”€ article
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â”œâ”€â”€ domain
  â”‚Â Â  â”œâ”€â”€ presentation
  â”‚Â Â  â””â”€â”€ query
  â”œâ”€â”€ articleFavoriteCount
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â””â”€â”€ domain
  â”œâ”€â”€ articleOrganization
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â””â”€â”€ domain
  â”œâ”€â”€ chatroom
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â”œâ”€â”€ domain
  â”‚Â Â  â”œâ”€â”€ presentation
  â”‚Â Â  â””â”€â”€ query
  â”œâ”€â”€ common
  â”‚Â Â  â””â”€â”€ config
  â”œâ”€â”€ evaluation
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â”œâ”€â”€ domain
  â”‚Â Â  â””â”€â”€ presentation
  â”œâ”€â”€ favorite
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â”œâ”€â”€ domain
  â”‚Â Â  â””â”€â”€ presentation
  â”œâ”€â”€ member
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â”œâ”€â”€ domain
  â”‚Â Â  â””â”€â”€ presentation
  â”œâ”€â”€ memberOrganization
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â”œâ”€â”€ domain
  â”‚Â Â  â””â”€â”€ presentation
  â”œâ”€â”€ organization
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â”œâ”€â”€ domain
  â”‚Â Â  â”œâ”€â”€ presentation
  â”‚Â Â  â””â”€â”€ query
  â”œâ”€â”€ security
  â”‚Â Â  â”œâ”€â”€ config
  â”‚Â Â  â”œâ”€â”€ core
  â”‚Â Â  â”œâ”€â”€ filter
  â”‚Â Â  â”œâ”€â”€ handler
  â”‚Â Â  â”œâ”€â”€ oauth2
  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ authentication
  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ provider
  â”‚Â Â  â”‚Â Â  â””â”€â”€ service
  â”‚Â Â  â””â”€â”€ web
  â””â”€â”€ trade
      â”œâ”€â”€ application
      â”œâ”€â”€ domain
      â””â”€â”€ presentation
```
```gherkin
chat
  â”œâ”€â”€ config
  â”œâ”€â”€ message
  â”‚Â Â  â”œâ”€â”€ application
  â”‚Â Â  â”œâ”€â”€ domain
  â”‚Â Â  â””â”€â”€ presentation
  â””â”€â”€ wholeMessage
      â”œâ”€â”€ application
      â”œâ”€â”€ domain
      â””â”€â”€ presentation
```

# Level 3

## ë„ë©”ì¸ ì„¤ê³„
ì²« ë„ë©”ì¸ ì„¤ê³„ ë•Œ ë§ì€ íšŒì˜ë¥¼ í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ì¤‘ ê°€ì¥ í™”ë‘ê°€ ëë˜ ê²ƒì€ **DDD íŒ¨í„´ì„ ì ìš©í• ê¹Œ?** ì…ë‹ˆë‹¤.
ê¸°ìˆ  ìŠ¤íƒ ìŠ¤í™íŠ¸ëŸ¼ì„ ë„ˆë¬´ ë„“ê²Œ ì¡ì€ ìš°ë¦¬ íŒ€ì€ DDD íŒ¨í„´ì„ ì•Œê³  ìˆëŠ” í¬ë£¨ê°€ ë§ì´ ì—†ì—ˆê¸° ë•Œë¬¸ì— ê±±ì •í•˜ì˜€ìŠµë‹ˆë‹¤.
DDD íŒ¨í„´ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ íŒ¨í‚¤ì§€ ë¶„ë¦¬ê°€ ë˜ì–´ìˆì§€ ì•Šì•„ ë„ë©”ì¸ ê°„ì˜ aggregateë¥¼ íŒŒì•…í•˜ê¸° ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤.
ê·¸ë ‡ê¸° ë•Œë¬¸ì— Aggregate ë‚´ë¶€ì˜ Entityë‚˜ VOì— ì ‘ê·¼í•  ë•Œ ì£¼ì²´ê°€ ë˜ëŠ” Aggregate Rootì„ ì°¸ì¡°í•˜ì§€ ì•Šê³  ì ‘ê·¼í•´ ë°ì´í„°ì˜ ë¬´ê²°ì„±ì´ ê¹¨ì§ˆ ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
DDD íŒ¨í„´ì„ ì ìš©í•´ ìƒëª…ì£¼ê¸°ê°€ ê°™ì€ ë³€ê²½ë‹¨ìœ„ë³„ë¡œ íŒ¨í‚¤ì§€ë¥¼ ë¶„ë¦¬í•´ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ê¸° ì‰½ê²Œ í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ë˜ëŠ” ê·¸ ì•ˆì˜ **ëª¨ë“ˆ ê°„ì˜ ì˜ì¡´ì„±ì€ ìµœì†Œí™”í•˜ê³ , ì‘ì§‘ì„±ì€ ìµœëŒ€í™”**
í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•˜ì˜€ìŠµë‹ˆë‹¤.

ìš°ë¦¬ íŒ€ì´ ë„ë©”ì¸ ì„¤ê³„ë¥¼ í•˜ë©´ì„œ ì£¼ë¡œ í–ˆë˜ ê³ ë¯¼ì…ë‹ˆë‹¤.
- Spring data ì“°ë‹¤ ë³´ë©´ Aggregate ê°œë…ì„ ì ìš©í•˜ê²Œ ë©ë‹ˆë‹¤. ([ì°¸ê³ ](https://www.slideshare.net/HyeonSeokChoi/ddd-repository)) ê·¸ë˜ì„œ ë³€ê²½ë‹¨ìœ„ë¥¼ ì–´ë–»ê²Œ ê°€ì ¸ê°€ì•¼ í•  ê²ƒì¸ê°€ì— ëŒ€í•œ ê³ ë¯¼ì´ ìˆì—ˆìŠµë‹ˆë‹¤.
- DDDì˜ í•µì‹¬ ëª©í‘œ ì¤‘ í•˜ë‚˜ì¸ "Loosely coupling" ì€ ë³µì¡í•œ ì—°ê´€ ê´€ê³„ê°€ ì ìš©ë˜ë©´ ì—°ê´€ëœ ê°ì²´ì— ëŒ€í•´ ë³€ê²½ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° í˜ë“­ë‹ˆë‹¤. ë”°ë¼ì„œ ê°ì²´ ì°¸ì¡°ë³´ë‹¤
Id ì°¸ì¡°ë¥¼ í•¨ìœ¼ë¡œì¨ ì—°ê´€ ê´€ê³„ë¥¼ ì—†ì•  ì¼ê´€ì„±ì„ ë” ì‰½ê²Œ ìœ ì§€ê³ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br/>
JPAë¥¼ í•™ìŠµí•˜ê³  ì ìš©í•´ë³´ê³  ì‹¶ì—ˆë˜ ìš°ë¦¬ëŠ” DDD ì— ë§ê²Œ ë‹¨ìˆœíˆ id ì°¸ì¡°ë¥¼ í•˜ëŠ” Spring data JDBCë¥¼ ì™€ Spring data JPA ì¤‘ ê²°ì •í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.
- ë‹¨ë°©í–¥ ì°¸ì¡°ë¥¼ í•˜ë‹¤ ë³´ë‹ˆ ì°¸ì¡°ë¥¼ í†µí•´ ìƒê¸´ foreign key constrain ë¬¸ì œë“¤ ì¤‘ cascade ê°™ì€ ë¬¸ì œë“¤ì„ ì–´ë–»ê²Œ í•´ê²°í•˜ëŠëƒëŠ” ê³ ë¯¼ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

í•´ë‹¹ ê³ ë¯¼ì— ëŒ€í•´ ì´ë ‡ê²Œ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.
- DDD ì˜ Aggregate ê°œë…ì„ ì ìš©í•´ íŒ¨í‚¤ì§€ë¥¼ êµ¬ì¡°í™”í•˜ì˜€ìŠµë‹ˆë‹¤.
ê·¸ëŸ°ë° Aggregate í•˜ëŠ” ë³€ê²½ë‹¨ìœ„ë¼ëŠ” ê²ƒì´ ëˆ„ê°€ ì–´ë–»ê²Œ ìƒê°í•˜ëŠ” ê±°ì— ë”°ë¼ ë‹¤ë¥¸ ê²ƒ ê°™ì•„ì„œ ë§ì€ ë…¼ìŸì´ ìˆì—ˆê³  ì´ êµ¬ì¡°ì— ëŒ€í•´ì„œëŠ” ê³„ì† ë°”ë€” ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
- JPAë¥¼ í•™ìŠµí•˜ê³  ì‹¶ì€ ìš•êµ¬ê°€ ë§ì•˜ê¸° ë•Œë¬¸ì— ê°ì²´ ì°¸ì¡°ë¥¼ í•˜ëŠ” JPAë¥¼ ì“°ë˜ í•˜ë‚˜ì˜ Aggregateì— í•˜ë‚˜ì˜ Repositoryë¥¼ ë§Œë“¤ì–´ ê´€ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.
- ì–‘ë°©í–¥ì„ í†µí•´ mapped By ë¡œ í•´ê²°í•˜ë˜ê°€ ë‹¨ë°©í–¥ cascade ì˜µì…˜ì„ ê±¸ì–´ì£¼ëŠ” ë°©ì‹ì´ í•´ê²°í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

- ì°¸ê³ 
    - [Domain-Driven Design and MVC Architectures](https://blog.fedecarg.com/2009/03/11/domain-driven-design-and-mvc-architectures/)
    - [ì¹´ì¹´ì˜¤í—¤ì–´ìƒµì˜ DDD](https://brunch.co.kr/@cg4jins/7) 
    - [DDD í•µì‹¬ë§Œ ë¹ ë¥´ê²Œ](https://happycloud-lee.tistory.com/94)
    - [DDD, Aggregate](https://medium.com/@chanhyeonglee/ddd-aggregate-ì• ê·¸ë¦¬ê±°íŠ¸-98d9c1313c23)
    - [ì• ê·¸ë¦¬ê²Œì‡ í•˜ë‚˜ì— ë¦¬íŒŒì§€í† ë¦¬ í•˜ë‚˜](https://medium.com/@SlackBeck/ì• ê·¸ë¦¬ê²Œì‡-í•˜ë‚˜ì—-ë¦¬íŒŒì§€í† ë¦¬-í•˜ë‚˜-f97a69662f63)
    
## ì²«ë²ˆì§¸ í´ë ˆìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
![Lv3ë„ë©”ì¸](images/Lv3_domain.png) 

## í”„ë¡œì íŠ¸ì—ì„œ ë§¡ì€ ì£¼ëœ ì—…ë¬´
### Front
- React Native, Expo, TypeScript, Recoil, Axios
    - í”„ë¡ íŠ¸ëŠ” íŒ€ì› ëª¨ë‘ í•™ìŠµí•˜ë©° ì§„í–‰í•´ì•¼ í–ˆê¸° ë•Œë¬¸ì— ì´ìŠˆë¥¼ ê³¨ê³ ë£¨ ê°€ì ¸ê°”ìŠµë‹ˆë‹¤.
### Back
- Spring Securtiy(OAuth2), Nginx, Https, Logback

í”„ë¡œì íŠ¸ì—ì„œ í˜¼ìì„œ ë§¡ê²Œ ëœ ê¸°ìˆ ë“¤ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ê¸°ìˆ ì„ ì ìš©í•˜ë©´ì„œ ê³µë¶€í–ˆë˜ ë°©ë²•ê³¼ ë‚´ìš©, ê³ ë¯¼ë“¤ì„ ê³µìœ í•˜ê² ìŠµë‹ˆë‹¤.

## Spring Securtiy(OAuth2 ì ìš©ê¸°)
### ì™œ Spring Securtiy ì¸ê°€?
ìš°ì„  ì‹œíë¦¬í‹°ë¥¼ ì ìš©í•˜ê¸° ì „ì— Form í˜•ì‹ì˜ íšŒì›ê°€ì…ì„ í†µí•´ Memberë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ 'ì‹¤ì œ ìš´ì˜í•´ì•¼ í•  ì„œë¹„ìŠ¤ì´ê¸° ë•Œë¬¸ì— ê°œì¸ì •ë³´ì— ëŒ€í•œ ë³´ì•ˆì— ì‹ ê²½ ì¨ì•¼ í•˜ì§€ ì•Šì„ê¹Œ?'ë¼ê³  ìƒê°í–ˆê³  ë³´ì•ˆ ìˆ˜ì¤€ì„ ë†’ì¼ ë°©ë²•ì´ ë­ê°€ ìˆì„ê¹Œ ìƒê°ì„ í•˜ì˜€ì„ ë•Œ
ê°„ë‹¨í•˜ì§€ë§Œ ê°•ë ¥í•˜ê²Œ êµ¬í˜„ í•  ìˆ˜ ìˆëŠ” ì´ë¯¸ ë†’ì€ ë³´ì•ˆ ìˆ˜ì¤€ì„ êµ¬ì¶•í•´ë‘” Spring Securityë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤.
Spring SecurityëŠ” ê°•ë ¥í•˜ë©´ì„œë„ ì‰½ìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ ë‹¨ ëª‡ì‹­ ì¤„ì˜ ì½”ë“œë§Œìœ¼ë¡œë„ ëŒ€í˜• ì›¹ì„œë¹„ìŠ¤ ì‚¬ì™€ ë¹„ìŠ·í•œ ìˆ˜ì¤€ì˜ ë³´ì•ˆì„ ìœ ì§€í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.
Spring SecurityëŠ” ìŠ¤í”„ë§ ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë³´ì•ˆì„ ìœ„í•´ **ì¸ì¦**ê³¼ **ê¶Œí•œ ë¶€ì—¬**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì ‘ê·¼ì„ ì œì–´**í•˜ëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ë˜ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### Spring Securityê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ë“¤
![security-features](images/security_features.png)
ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ Spring Securityë¥¼ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìœ„ì˜ ê¸°ëŠ¥ë“¤ ì¤‘ í•„ìš”í•œ ë¶€ë¶„ì„ ëª¨ë‘ ì†ìˆ˜ ë‹¤ êµ¬í˜„í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

**ê·¸ëŸ¬ë‹ˆ ì•ˆ ì“¸ ì´ìœ ê°€ ì—†ê² ì£ ?**

ë˜ Securityì—ì„œ OAuth2ë¥¼ Resource sever ë¡œì„œ êµ¬í˜„ì„ í•  ìˆ˜ë„ ìˆê³  Client ë¡œì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ ë‘ì—ˆìŠµë‹ˆë‹¤.
Spring Securityë¥¼ ì´ìš©í•˜ì§€ ì•Šê³  RestTemplateì´ë‚˜ WebClientë¡œ OAuthë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ì— API ìš”ì²­ì„ ì˜ê³  Redirectë¥¼ êµ¬í˜„í•´ OAuthë¥¼ ì´ìš©í•  ìˆ˜ ìˆì§€ë§Œ
ê·¸ ëª¨ë“  ê²Œ Spring Securityì— êµ¬í˜„ì´ ë˜ì–´ìˆê¸° ë•Œë¬¸ì— Spring Securityë¥¼ ì‚¬ìš©í•´ ì¹´ì¹´ì˜¤ OAuth ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ì— ë”°ë¥¸ ëŒ€ê°€ê°€ ìˆëŠ”ë° ë„ˆë¬´ ë†’ì€ ì¶”ìƒí™” ìˆ˜ì¤€ ë•Œë¬¸ì— ì—­ì¶”ì ì´ ì‰½ì§€ê°€ ì•Šê³  ì§ì ‘ ë””ë²„ê¹…ì„ í•˜ë©´ì„œ ë”°ë¼ê°€ì§€ ì•Šìœ¼ë©´ ê·¸ íë¦„ì„ íŒŒì•…í•˜ê¸° ì–´ë µë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ğŸ˜­
ê·¸ë˜ì„œ ë¨¼ì € ê¸°ë³¸ì ì¸ Spring Security [ì•„í‚¤í…ì²˜](https://spring.io/guides/topicals/spring-security-architecture) ì— ëŒ€í•´ ì•Œê³  ê°€ì•¼ í•œë‹¤ê³  ìƒê°í•˜ì˜€ê³  í•™ìŠµ í›„ ë””ë²„ê¹…ì„ í•´ë³´ë©° ë”°ë¼ê°”ì„ ë•Œ ë” ë¹ ë¥´ê²Œ í¡ìˆ˜ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

- ì°¸ê³ 
    - [Spring Security ìŠ¤í”„ë§ ì‹œíë¦¬í‹°](https://sieunlim.tistory.com/19)
    - [Spring Security Docs](https://docs.spring.io/spring-security/site/docs/5.1.5.RELEASE/reference/htmlsingle/#hello-web-security-java-configuration)

### Spring Securityì˜ êµ¬ë™ì›ë¦¬, ì•„í‚¤íƒì²˜
#### ì™œ ì•Œì•„ì•¼ í• ê¹Œ?
OAuthë¥¼ ì ìš©í•˜ê¸° ì „ì— ë¨¼ì € Spring Securityì˜ êµ¬ë™ì›ë¦¬ì™€ ì•„í‚¤í…ì²˜ì— ëŒ€í•´ ë¨¼ì € í•™ìŠµí•˜ì˜€ìŠµë‹ˆë‹¤. ì²˜ìŒì—ëŠ” ë¬´í„±ëŒ€ë¡œ ë¸”ë¡œê·¸ì˜ ê¸€ì„ ë³µë¶™í•˜ëŠ” í˜•ì‹ì´ì˜€ìŠµë‹ˆë‹¤.
ì½”ë“œë¥¼ ê·¸ëŸ°ì‹ìœ¼ë¡œ ê¸ì–´ì™€ ì‚¬ìš©í•˜ë‹ˆ ê·¸ì— ë”°ë¥¸ ë¶€ì‘ìš©ì€ ë”ìš± ì»¸ìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ë¶€ì‘ìš©ë“¤ì´ ë§ì•˜ì§€ë§Œ ê°€ì¥ í° ë‘ê°€ì§€ë¥¼ ê³µìœ í•˜ê² ìŠµë‹ˆë‹¤.

- êµ¬í˜„ì„ í•˜ëŠ” ì‚¬ëŒì´ì§€ë§Œ OAuth ë¡œê·¸ì¸ íë¦„ì„ íŒŒì•…í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.
- ìš°ë¦¬ í”„ë¡œë•íŠ¸ í™˜ê²½ì—ì„œ í•„ìš”ì—†ëŠ” ì½”ë“œë“¤ì´ ìƒê²¨ë‚¬ê³  ê·¸ ê°’ë“¤ì´ DBì— ì €ì¥ë˜ê¸° ê¹Œì§€ í–ˆìŠµë‹ˆë‹¤.

ì´ëŸ° ë¶€ì‘ìš©ì„ ì—†ì• ê¸° ìœ„í•´ì„œëŠ” í•™ìŠµì´ ë¬´ì¡°ê±´ ì ìœ¼ë¡œ í•„ìš”í–ˆìŠµë‹ˆë‹¤.

**ë¨¼ì € Spring Security ë¥¼ ì•Œê¸° ì „ì— ë¯¸ë¦¬ ì•Œì•„ê°€ê³  ë“¤ì–´ê°€ì•¼í•  ê°œë… ëª‡ê°€ì§€ë¥¼ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.**

### ìš©ì–´
ìš©ì–´ì— ëŒ€í•´ ë¨¼ì € ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. ê·¸ ë‚˜ë¼ì˜ ì–¸ì–´ë¥¼ ëª¨ë¥¸ë‹¤ë©´ ì˜ì‚¬ì†Œí†µì´ ê°€ëŠ¥í• ê¹Œìš”? ì‹œíë¦¬í‹°ë¥¼ ì˜ ì´í•´í•˜ê¸° ìœ„í•´ì„  ë¨¼ì € ì•Œê³ ê°€ì•¼í•œë‹¤ ìƒê°í•©ë‹ˆë‹¤. 
- ì ‘ê·¼ ì£¼ì²´(Principal): ë³´í˜¸ëœ ëŒ€ìƒì— ì ‘ê·¼í•˜ëŠ” ìœ ì €
- ì¸ì¦(Authenticate): ìš”ì²­ì„ ë³´ë‚¸ ìœ ì €ê°€ ëˆ„êµ¬ì¸ì§€ í™•ì¸(ex. ë¡œê·¸ì¸), ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì£¼ì²´ì„ì„ ì¦ëª…
- ì¸ê°€(Authorization): í˜„ì¬ ìœ ì €ê°€ ì–´ë–¤ ì„œë¹„ìŠ¤, í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬
    - ê¶Œí•œ: ì¸ì¦ëœ ì£¼ì²´ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ
        - ë¨¼ì € ì¸ì¦ ê³¼ì •ì„ í†µí•´ ì£¼ì²´ê°€ ì¦ëª… ëœ ì´í›„ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŒ
        - ê¶Œí•œ ë¶€ì—¬ì—ë„ ë‘ ê°€ì§€ ì˜ì—­ì´ ì¡´ì¬í•˜ëŠ”ë° ì›¹ ìš”ì²­ ê¶Œí•œ, ë©”ì†Œë“œ í˜¸ì¶œ ë° ë„ë©”ì¸ ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ ë¶€ì—¬ê°€ ìˆìŒ
    +)ì¸ì¦ê³¼ ê¶Œí•œì„ êµ¬ë¶„í•´ ìƒê°í•˜ëŠ” ê²ƒì´ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´í•´í•˜ëŠ”ë° ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤.
- ì¦ëª…ì„œ(Credential) : ì¸ì¦ ê³¼ì • ì¤‘, ì£¼ì²´ê°€ ë³¸ì¸ì„ ì¸ì¦í•˜ê¸° ìœ„í•´ ì„œë²„ì— ì œê³µí•˜ëŠ” ê²ƒ. (ID, Password ê°™ì€ ê²ƒ)

### SecurityContextHolder
![SecurityContextHolder](images/securitycontextholder.png)
ë ˆí¼ëŸ°ìŠ¤ì— ë³´ë©´ SecurityContextHolder ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„í•©ë‹ˆë‹¤.
 
>At the heart of Spring Securityâ€™s authentication model is the SecurityContextHolder

Spring security ì˜ í•µì‹¬ì´ë¼ê³  í•  ìˆ˜ìˆëŠ”ë°ìš”. Spring security ëŠ” SecurityContextHolderë¥¼ ì´ìš©í•´ ì¸ì¦ê°ì²´ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
SecurityContextHolderëŠ” ì¸ì¦ëœ userì˜ details ë¥¼ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. details ì—ëŠ” ì–´ë–¤ Authentication ê°ì²´ë¥¼ ì“°ëŠëƒì— ë”°ë¼ ë‹¬ë¼ì§€ëŠ”ë°
FormLoginì„ ì‚¬ìš©í•  ê²½ìš° UserDetails ì— ëŒ€í•œ ë‚´ìš©ì´ OAuth2Loginì„ ì‚¬ìš©í•  ê²½ìš° OAuth2User ì— ëŒ€í•œ ë‚´ìš©ì´ ì €ì¥ë©ë‹ˆë‹¤.
ìš°ë¦¬ í”„ë¡œë•íŠ¸ì—ëŠ” OAuth2 ë¥¼ ì‚¬ìš©í•˜ë‹ˆ OAuth2User ì•  ëŒ€í•œ ë‚´ìš©ì´ ë“¤ì–´ê°€ê² ì£ ?

> The SecurityContextHolder is where Spring Security stores the details of who is authenticated. Spring Security does not care how the SecurityContextHolder is populated. If it contains a value, then it is used as the currently authenticated user.
>
> The simplest way to indicate a user is authenticated is to set the SecurityContextHolder directly.

SecurityContextHolderëŠ” ì–´ë–»ê²Œ ì €ì¥ë˜ëŠ”ì§€ ë°©ì‹ì—ëŠ” ê´€ì‹¬ì´ ì—†ë‹¤ê³  í•©ë‹ˆë‹¤. ì¦‰, SecurityContextHolder ì— ì¸ì¦ê°ì²´ê°€ ìˆë‹¤ë©´
ê·¸ ê°ì²´ëŠ” ì¸ì¦ëœ ê°ì²´ë¼ê³  ìƒê°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëƒ¥ Security FilterChainì— Authentication í•˜ëŠ” Filterê°€ ìˆìŠµë‹ˆë‹¤.
ê·¸ ê³¼ì •ì„ ê±°ì¹˜ì§€ ì•Šì•„ë„ ì§ì ‘ SecurityContextHolder ì— setìœ¼ë¡œ ë„£ì–´ì¤€ë‹¤ë©´ ê·¸ ê°ì²´ëŠ” ì¸ì¦ëœ ê°ì²´ë¼ê³  ìƒê°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì´ ë¶€ë¶„ì„ ì´ìš©í•´ì„œ JwtAuthenticationFilter ë¥¼ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤.

SecurityContextHolderë¥¼ set í•˜ê¸° ìœ„í•´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.

```java
SecurityContext context = SecurityContextHolder.createEmptyContext();  // (1) 
Authentication authentication =
    new TestingAuthenticationToken("username", "password", "ROLE_USER"); // (2) 
context.setAuthentication(authentication);

SecurityContextHolder.setContext(context);
```

SecurityContextëŠ” SecurityContextHolderë¡œ ë¶€í„° ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. SecurityContextëŠ” Authentication ê°ì²´ë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤.

1. ë¹„ì–´ìˆëŠ” SecurityContext ë§Œë“­ë‹ˆë‹¤. ìœ„ì˜ ê³¼ì •ì„ **SecurityContextHolder.getContext().setAuthentication(authentication)** ë¡œ í•œ ë²ˆì— ì„ ì–¸í•˜ëŠ” ê±¸ í”¼í•˜ë¼ê³  ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤.
ì €ë ‡ê²Œ ì„ ì–¸í•œë‹¤ë©´ ë©€í‹°ìŠ¤ë ˆë“œì¼ ê²½ìš° ê²½í•©ìƒíƒœ(race Condition) ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.
2. ê·¸ í›„ Authenticationì„ ì„ ì–¸í•´ ì €ì¥í•©ë‹ˆë‹¤. **Authenticationì€ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.**
Spring SecurityëŠ” ì–´ë–¤ ì¢…ë¥˜ì˜ Authenticationì¸ì§€ëŠ” ê´€ì‹¬ì´ ì—†ìŠµë‹ˆë‹¤. Authenticationì„ êµ¬í˜„í•œ êµ¬í˜„ì²´ì´ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

Spring SecurityëŠ” SecurityContextHolder ì— ì €ì¥ëœ ë‚´ìš©ì„ ì¸ê°€(Authorization)ë¥¼ ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤.

- [Spring Security Docs](https://docs.spring.io/spring-security/site/docs/current/reference/html5/#servlet-authentication-securitycontextholder)

### ThreadLocal

SecurityContextHolderë¥¼ ì´í•´í•˜ëŠ” ë° ê¼­ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. SecurityContextHolderëŠ” ì „ëµì ìœ¼ë¡œ ì–´ë–»ê²Œ ì‚¬ìš©í•  ê²ƒì¸ì§€ ì •í•´ì§‘ë‹ˆë‹¤.
ë””í´ë“œ ê°’ì€ ThreadLocal ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ThreadLocal ì´ë€ ê°„ë‹¨íˆ ì„¤ëª…í•´ì„œ ìŠ¤ë ˆë“œ ì§€ì—­ ë³€ìˆ˜ì…ë‹ˆë‹¤. ê°™ì€ Thread í•˜ëŠ” Scope ë‚´ì—ì„œ ê³µìœ ë˜ì–´ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ê°’ìœ¼ë¡œ **ë‹¤ë¥¸ ìŠ¤ë ˆë“œ**ì—ì„œ
ê³µìœ ë³€ìˆ˜ì— ì ‘ê·¼í•  ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” **ë™ì‹œì„± ë¬¸ì œì˜ ì˜ˆë°©**ì„ ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. Securityì˜ ThreadLocalSecurityContextH í´ë˜ìŠ¤ë¥¼ ë³´ë©´
ThreadLocalì„ staticìœ¼ë¡œ ì„ ì–¸í•©ë‹ˆë‹¤. ê·¸ ì´ìœ ë¥¼ ìƒê°í•´ ë³¸ë‹¤ë©´ ì´ëŸ° ì´ìœ ì´ì§€ ì•Šì„ê¹Œ ìƒê°ë©ë‹ˆë‹¤.
ThreadëŠ” ThreadLocalì„ Mapìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ìˆì–´ì„œ ì—¬ëŸ¬ ê°œì˜ ThreadLocal ê°’ì„ ê°€ì§€ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

staticìœ¼ë¡œ ì„ ì–¸í•˜ë©´ í•´ì‹œê°’ì´ í•­ìƒ ê°™ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ ThreadLocalì„ ê³„ì† ì“¸ ìˆ˜ ìˆì–´ ì¸ì¦ê°ì²´ë¥¼ set í•œ í›„ ê³„ì†í•´ì„œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.
ë§Œì•½ staticì„ ì„ ì–¸í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ getContext ë¥¼ ì„ ì–¸í•  ë•Œë§ˆë‹¤ ê³„ì† TheadLocalì„ ìƒì„±í•´ì„œ ë‹¤ë¥¸ ë©”ì„œë“œì—ì„œ SecurityContextë¥¼ ì‚¬ìš©í• ë•Œ ì˜¬ë°”ë¥´ì§€ ëª»í•œ ë°ì´í„°ë¥¼ ì°¸ì¡°í•  ê²ƒì…ë‹ˆë‹¤.

ì•„ë˜ ThreadLocalSecurityContextH í´ë˜ìŠ¤ë¥¼ í™•ì¸í•´ ë³´ë©´ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ThreadLocalSecurityContextHolderStrategy
![ThreadLocalSecurityContextHolderStrategy](images/thread.png)
- ThreadLocal 
![ThreadLocal](images/threadLocal.png)

ë˜ Spring Docsì— ë³´ë©´ ì´ëŸ° ë§ì´ ìˆìŠµë‹ˆë‹¤.
> Using a ThreadLocal in this way is quite safe if care is taken to clear the thread after the present principalâ€™s request is processed. Spring Securityâ€™s FilterChainProxy ensures that the SecurityContext is always cleared.

ìš”ì²­ì´ ëë‚˜ë©´ ìŠ¤ë ˆë“œë¥¼ ë¹„ì›Œë²„ë¦°ë‹¤ëŠ” ë‚´ìš©ì¸ë° ì´ ë¶€ë¶„ë„ ThreadLocalSecurityContextHolderStrategy ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
Contextë¥¼ getì„ í•˜ëŠ”ë° ë§Œì•½ ìŠ¤ë ˆë“œê°€ ë¹„ì–´ìˆì§€ ì•ŠëŠ”ë‹¤ë©´ ì“°ë ˆë“œê°€ ì¬ì‚¬ìš©ë ë•Œ ì“°ë ˆë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ë‹¤ë¥¸ ì¸ì¦ìš”ì²­ì´ ì™€ë„ ì´ë¯¸ TheadLocalì— ì´ì „ì— ì‚¬ìš©ëœ ì¸ì¦ê°ì²´ê°€ ìˆì–´ì„œ ìƒˆë¡œìš´ ì¸ì¦ ìš”ì²­ì´ ì™€ë„ ì¸ì¦ëœ ì‚¬ìš©ìë¼ê³  ì¸ì¦ í—ˆê°€ë¥¼ ë‚´ì¤„ ê²ƒì…ë‹ˆë‹¤.

#### í—·ê°ˆë ¸ë˜ ë¶€ë¶„
- SecurityContextHolder ì™€ Session
    - SecurityContextHolder ëŠ” Spring Securityì˜ ì¸ë©”ëª¨ë¦¬ ì„¸ì…˜ì €ì¥ì†Œ ì…ë‹ˆë‹¤.
    ì‹œíë¦¬í‹°ì˜ ì„¤ì •ì¤‘ì— ì¸ì¦ê³¼ì •ì‹œ Sessionì„ ë„ëŠ” ì„¤ì •ì´ ìˆìŠµë‹ˆë‹¤.
        ```java
        sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
        ```
        [JWT](https://velopert.com/2350) ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— Sessionì„ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ì–´ì„œ í•´ë‹¹ ì„¤ì •í•´ì£¼ì—ˆëŠ”ë°
         ë””ë²„ê¹…ì—ì„œ SecurityContextHolder ë¡œ ê³„ì† ì¸ì¦ê°ì²´ë¥¼ ì €ì¥í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
        
         ì—¬ê¸°ì„œ ì œê°€ í—·ê°ˆë¦° ê±°ëŠ” **ì„¸ì…˜**ì´ë€ ë‹¨ì–´ë¥¼ í˜¼ë™í•˜ê³  ìˆì—ˆë˜ ê²ƒì…ë‹ˆë‹¤. ì €ëŠ” ì„¸ì…˜ì´ë¼ í•¨ì€ HttpSession ì„ ë§í•˜ëŠ” ì¤„ ì•Œì•˜ê±°ë“ ìš”.
         ê·¸ë˜ì„œ SecurityContextHolder ì¸ ì¸ë©”ëª¨ë¦¬ **ì„¸ì…˜**ì„ ê³„ì† ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë„ˆë¬´ ì´ìƒí–ˆìŠµë‹ˆë‹¤.
         ì§€ê¸ˆ ìƒê°í•˜ë©´ ì •ë§ ë°”ë³´ ê°™ì€ ìƒê°ì´ì£ 
        
         ë¶€ë„ëŸ½ì§€ë§Œ, ì €ì™€ ê°™ì€ ìƒê°ì„ í•˜ëŠ” ì‚¬ëŒì´ ìˆì„ ìˆ˜ ìˆê¸°ì—.. ê¸°ë¡ì— ë‚¨ê¹ë‹ˆë‹¤.
        
         ì¢€ ìì„¸íˆ ë“¤ì–´ê°€ ë³´ìë©´ ìš°ë¦¬ê°€ í”íˆ ì›¹ í™˜ê²½ì—ì„œ ì“°ëŠ” Sessionì€ HttpSessionì„ ì´ì•¼ê¸°í•©ë‹ˆë‹¤.
         í†°ìº£ì„ ì˜ˆë¡œ ë“¤ë©´ í†°ìº£ì—ì„œ í™œìš©í•  ìˆ˜ ìˆëŠ” ê°ì²´ ë²”ìœ„ì˜ ì¢…ë¥˜(application, session, request, page) ì¤‘ í•˜ë‚˜ì¸ sessionì´ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
         Spring Securityì—ì„œëŠ” í†°ìº£ì˜ ê°ì²´ ë²”ìœ„(scope) ì¤‘ í•˜ë‚˜ì¸ sessionì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼
         Threadlocalì´ë¼ëŠ” ê°ì²´ ë²”ìœ„(scope)ë¥¼ í™œìš©í•©ë‹ˆë‹¤.
        
         **Sessionì´ë¼ëŠ” ê°œë…ì´ ì˜ ì•ˆ ì¡í˜”ê¸° ë•Œë¬¸ì— ë‚˜ì˜¨ ë¬¸ì œì´ì£ .**
        
         [Session](https://ko.wikipedia.org/wiki/ì„¸ì…˜_(ì»´í“¨í„°_ê³¼í•™)) ì´ë€ **ë‘ ê°œ ë˜ëŠ” ê·¸ ì´ìƒì˜ ì˜ì‚¬ì†Œí†µí•˜ëŠ” ì¥ì¹˜ë“¤(devices) ë˜ëŠ” ì»´í“¨í„° ê·¸ë¦¬ê³  ìœ ì € ê°„ì— ëŒ€í™”, íšŒí™” ë˜ëŠ” íšŒì˜ì™€ ê°™ì€ ë°˜ì˜êµ¬ì ì¸ ìŒë°©í–¥ ì •ë³´ êµí™˜ì…ë‹ˆë‹¤.**
         Sessionì€ ì •ë³´êµí™˜ì´ë¼ëŠ” ì˜ë¯¸ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì´ì§€ HttpSessionì´ë¼ëŠ” íŠ¹ì •í•œ ê²ƒì„ ë‚˜íƒ€ë‚´ëŠ” ê²Œ ì•„ë‹ˆë¼ëŠ” ê²ë‹ˆë‹¤.
        
         ì´ ì°¨ì´ë¥¼ ì•Œê²Œ ë˜ë‹ˆ í™•ì‹¤íˆ ì´í•´ë˜ë”ë¼ê³ ìš”. í•´ë‹¹ ë‚´ìš©ì„ ì˜ ì¸ì§€í•˜ê³  ë“¤ì–´ê°€ë©´ ë” ë¹ ë¥¸ ì´í•´ë¥¼ í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.
         
         Security ê°€ ì™œ HttpSessionì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ThreadLocal ì„ ì‚¬ìš©í–ˆëŠ”ì§€ì— ëŒ€í•´ ëª‡ê°€ì§€ ì´ìœ ê°€ ìˆìŠµë‹ˆë‹¤.
         1. HttpSessionì€ ì„œë¸”ë¦¿ì„ ì˜ì¡´ì í•˜ê³  ìˆìŠµë‹ˆë‹¤. SecurityëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì„œë¸”ë¦¿ í•„í„°ë¥¼ ì´ìš©í•´ ì„œë¸”ë¦¿ ë³´ì•ˆì„ ê¸°ë³¸ìœ¼ë¡œí•˜ì§€ë§Œ ì„œë¸”ë¦¿ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì•„ë‹Œ 
         ìë°” ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.
         2. HttpSessionì— ì €ì¥í•˜ì§€ ì•Šê³  ì™¸ë¶€ë¡œ ì¸ì¦ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í˜•íƒœë¡œ êµ¬í˜„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.(ê¸°ë³¸ í´ë˜ìŠ¤ë¥¼ í™•ì¥í•˜ì—¬ DB ë˜ëŠ” Redis,MongoDB ë“±ìœ¼ë¡œ ì¸ì¦ ì •ë³´ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)
         3. AOP ë° ì¸í„°ì…‰í„° ë“± ê³µë™í”„ë ˆì„ ì›Œí¬ë¥¼ ë§Œë“¤ ì‹œ ìœ ìš©í•©ë‹ˆë‹¤.
         
         2,3ì— ëŒ€í•œ ì´ìœ ëŠ” ì•„ì§ í™•ì‹¤í•˜ê²Œ ì™€ë‹¿ì§€ ì•Šì§€ë§Œ 1ì˜ ì´ìœ ë§Œìœ¼ë¡œ ì´í•´í•˜ê¸°ì—ëŠ” ì¶©ë¶„í•˜ë‹¤ê³  ë´…ë‹ˆë‹¤!
         
         
- ì°¸ê³ 
    - [ThreadLocalì´ë€1](https://devonce.tistory.com/25)
    - [ThreadLocalì´ë€2](https://velog.io/@cbbatte/Spring-Security-ì•„í‚¤í…ì²˜-1)
    - [SecurityContextHolderë¥¼ staticìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ë° ì–´ë–»ê²Œ í•„í„°ì—ì„œ í•„ìš”í•œ SecurityContextë¥¼ ì°¾ì„ ìˆ˜ ìˆì„ê¹Œ?](https://sungminhong.github.io/spring/security/#2-spring-securityì˜-êµ¬ì¡°)
    - [ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ê°ì²´ ë²”ìœ„](https://victorydntmd.tistory.com/155)
    - [session ì´ë€](https://devhaks.github.io/2019/04/20/session-strategy/)
    - [ThreadLocal ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ](https://brunch.co.kr/@sbcoba/11)

### Spring Security êµ¬ì¡°
#### í•„í„° ë™ì‘ì›ë¦¬
![filterChain](images/filterChain.png)

Spring SecurityëŠ” ì„œë¸”ë¦¿ í•„í„° ê¸°ë°˜ì´ë¼ ë¨¼ì € í•„í„°ì˜ ì—­í• ì„ ì•Œê³  ê°„ë‹¤ë©´ ë§ì€ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.
ì–´ë–¤ ìš”ì²­ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ ì»¨í…Œì´ë„ˆëŠ” í•„í„°ë“¤ê³¼ ì„œë¸”ë¦¿ì„ ë§Œë“­ë‹ˆë‹¤. ë³´í†µ í•˜ë‚˜ì˜ ì„œë¸”ë¦¿ì€ í•˜ë‚˜ì˜ request, reponseë§Œ ë‹¤ë£° ìˆ˜ ìˆì§€ë§Œ, í•„í„°ë“¤ì€ ì²´ì¸ìœ¼ë¡œ ì—°ê²°ë˜ì–´ìˆì–´
ë‹¤ìŒ í•„í„°ì—ì„œ ì“¸HttpServletRequest ì™€ HttpServletResponse ìˆ˜ì •í•©ë‹ˆë‹¤.
Chainìœ¼ë¡œ ì—°ê²°ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ìˆœì„œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.

#### DelegatingFilterProxy
Springì˜ ApplicationContextì™€ Servlet Containerì˜ lifecycle ì˜ ì‚¬ì´ë¥¼ ì—°ê²°í•´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
Servlet ContainerëŠ” ê·¸ë“¤ì˜ í‘œì¤€ì— ë”°ë¼ í•„í„°ë¥¼ ë“±ë¡í•˜ëŠ”ë° ìŠ¤í”„ë§ ë¹ˆì— ëŒ€í•´ì„œëŠ” ì¸ì§€í•˜ì§€ ëª»í•©ë‹ˆë‹¤. ë”°ë¼ì„œ
DelegatingFilterProxy ê°€ Servlet Container í‘œì¤€ì„ í†µí•´ Beanì„ í•„í„°ë¡œ ë“±ë¡í•´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

ë˜ DelegatingFilterProxy ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ Spring Bean ë“±ë¡ ì‹œì ê³¼ í•„í„°ì˜ ë“±ë¡ ì‹œì ì´ ë§ì§€ ì•ŠëŠ” ë¶€ë¶„ë„ í•´ê²°í•´ì¤ë‹ˆë‹¤.
FilterëŠ” Servlet Containerê°€ ì‹œì‘ë˜ê¸° ì „ì— í•„í„°ë¥¼ ë“±ë¡í•  í•„ìš”ê°€ ìˆëŠ”ë° Spring Beanì€ ê·¸ ì´í›„ì— ë“±ë¡ì´ ë©ë‹ˆë‹¤.
ë”°ë¼ì„œ DelegatingFilterProxy ë¥¼ í†µí•´ Filter Beanì„ lazy í•˜ê²Œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> Another benefit of DelegatingFilterProxy is that it allows delaying looking Filter bean instances. This is important because the container needs to register the Filter instances before the container can startup. However, Spring typically uses a ContextLoaderListener to load the Spring Beans which will not be done until after the Filter instances need to be registered.

#### FilterChainProxy
FilterChainProxy ëŠ” Spring Securityì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” íŠ¹ìˆ˜í•œ í•„í„°ì…ë‹ˆë‹¤. FilterChainProxy ëŠ” SecurityFilterChainë¥¼ í†µí•´ì„œ ë§ì€ í•„í„°ë“¤ì— ì—­í• ì„ ìœ„ì„í•©ë‹ˆë‹¤.
FilterChainProxy ëŠ” Beanì´ê¸° ë•Œë¬¸ì— DelegatingFilterProxyì— ì˜í•´ ê´€ë¦¬ë©ë‹ˆë‹¤(wrapped in).

#### SecurityFilterChain
FilterChainProxy ê°€ ì‚¬ìš©ì„ í•©ë‹ˆë‹¤. ì–´ë–¤ í•„í„°ë¥¼ í˜¸ì¶œí• ì§€ ê²°ì •í•©ë‹ˆë‹¤.
![SecurityFilterChain](images/SecurityFilterChain.png)

Security Filter ë“¤ì€ Bean ì´ì§€ë§Œ DelegatingFilterProxy Filterì— ì˜í•´ ë“±ë¡ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ FilterChainProxy ì— ìƒíƒœê°’ìœ¼ë¡œ ê°–ê³ ìˆìŠµë‹ˆë‹¤.

ì—¬ê¸°ì—ëŠ” ë‹¤ì–‘í•œ ì´ìœ ê°€ ìˆìŠµë‹ˆë‹¤.

1. Spring Security servlet supportì˜ ì‹œì‘ì ì„ ì•Œë ¤ì¤ë‹ˆë‹¤. ë§Œì•½ Spring Security ì— ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ
FilterChainProxyë¥¼ ë””ë²„ê¹…ì„ í•´ë³´ë©´ ë°”ë¡œ ì•Œ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì´ì ì´ ìˆìŠµë‹ˆë‹¤. DelegatingFilterProxyëŠ” ì‹œíë¦¬í‹°ì˜ í•„í„°ê°€ ì•„ë‹™ë‹ˆë‹¤.
DelegatingFilterProxyëŠ” Springì˜ ApplicationContextì—ì„œ ì–»ì€ Filter Beanë¥¼ ëŒ€ì‹  ì‹¤í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
package ìœ„ì¹˜ë¥¼ ë³´ë©´ `springframework.web.filter` ë¡œ ì‹œíë¦¬í‹°ê°€ ì•„ë‹˜ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2. Spring Securityì˜ ì¤‘ì‹¬ì´ê¸° ë•Œë¬¸ì— ì˜µì…˜ìœ¼ë¡œ ì„ íƒë˜ì§€ ì•Šì€ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ SecurityContextëŠ” ë§¤ ìš”ì²­ì´ ëë‚˜ê³  ë‚˜ì„œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë§‰ê¸° ìœ„í•´ í•­ìƒ Clear í•´ì•¼ í•˜ëŠ”ë°
ê·¸ëŸ° ì¼ì„ ë§¡ì•„ì„œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜ Spring Securityâ€™s HttpFirewallì„ ì ìš©í•´ íŠ¹ì • ê³µê²©ìœ¼ë¡œë¶€í„° ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. SecurityFilterChainë¥¼ ìœ ì—°í•˜ê²Œ ê°€ì ¸ê°ˆ ìˆ˜ ìˆë‹¤. ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ í•„í„°ëŠ” URIë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.
ê·¸ëŸ°ë° SecurityFilterChainëŠ” RequestMatcher interfaceë¥¼ ì‚¬ìš©í•´ì„œ HttpServletRequestì•ˆì— ìˆëŠ” ê°’ìœ¼ë¡œ
ê¸°ë°˜ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

ê·¸ë˜ì„œ FilterChainProxy ì‚¬ì‹¤ ì–´ë–¤ SecurityFilterChain ë¥¼ ì‚¬ìš©í• ì§€ ê³ ë¥´ëŠ”ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![SecurityFilterChain2](images/SecurityFilterChain2.png)

ì´ ë¶€ë¶„ì€ Security ì„¤ì •ì— ìˆì–´ì„œ ì¤‘ìš”í•©ë‹ˆë‹¤. SecurityFilterChain ë“¤ì— ìˆœì„œê°€ ìˆê¸° ë•Œë¬¸ì—
ë§Œì•½ /\*\*, /api/\*\* ìˆœì„œë¡œ ì„¤ì •ì„ í–ˆë‹¤ë©´ ëª¨ë“  ìš”ì²­ì´ /** ì— match ë˜ì–´  /api/\*\* ì— ëŒ€í•´ì„œëŠ” match ë˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì•ì—ì„œ ë‹¤ ê°€ë¡œì±„ëŠ” ê²ƒì´ì£ 

ì´í•´í•˜ê¸° ì¢‹ê²Œ ì œê°€ ì´ë²ˆì— ì„¤ì •í•œ ì‹œíë¦¬í‹° ì„¤ì •ì— ê´€í•´ì„œ ì´ì•¼ê¸° í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
![securityConfig](images/securityConfig.png)
ì´ë ‡ê²Œ ì„¤ì •ì´ ë˜ì–´ìˆë‹¤ë©´ /oauth2/** ì— ëŒ€í•œ URLì€ ì²« ë²ˆì§¸ matcher ë•Œë¬¸ì— ë„ë‹¬í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤.

ê·¸ë ‡ê¸° ë•Œë¬¸ì— match ìˆœì„œì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

**-----ìˆ˜ì •------**

ìœ„ì™€ ê°™ì€ ì„¤ì •ì€ ë‹¨ì§€ í•˜ë‚˜ì˜ íŒ¨í„´ì— setì„ í†µí•´ appendì²˜ëŸ¼ ì´ì–´ë¶™ì–´ë‚˜ê°€ëŠ” ê²ƒì´ë¼ê³  í•©ë‹ˆë‹¤.
FilterChainProxyëŠ” config í•˜ë‚˜ë‹¹ í•˜ë‚˜ì˜ SecurityFilterChain ë§Œë“­ë‹ˆë‹¤. ë”°ë¼ì„œ 2ê°œì˜
configë¥¼ ë§Œë“¤ì–´ orderë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

- ì°¸ê³ 
    - [docs](https://docs.spring.io/spring-security/site/docs/5.3.3.BUILD-SNAPSHOT/reference/html5/#servlet-multi-securityfilterchain-figure)
    - [ì—”ê¾¸ê¾¸-ì•„í‚¤íƒì²˜](https://pupupee9.tistory.com/113)
    - [stackoverflow](https://stackoverflow.com/questions/53999591/spring-security-oauth2-how-to-add-multiple-security-filter-chain-of-type-resour)
    - [DelegatingFilterProxy FliterChainProxy ë¹ˆì£¼ì… ì–´ë–»ê²Œ?](https://yoon0120.tistory.com/47)
    - [Spring Bean ì£¼ì…](https://loginfo.dev/SpringBeanLifeCycle)
    
#### ê³µë¶€í•˜ë‹¤ ì•Œê²Œ ëœ ë‚´ìš© context
ì´ ë¶€ë¶„ì„ ê³µë¶€í•˜ë‹¤ê°€ contextì— ëŒ€í•´ ìì„¸í•˜ê²Œ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. Springì—ì„œ ê´€ë¦¬í•˜ëŠ” contextë¡œ
ApplicationContext ì™€ ApplicationContextë¥¼ ìƒì†ë°›ì€ WebApplicationContext ê°€ ìˆìŠµë‹ˆë‹¤.
WebApplicationContextì€ ë‹¤ì‹œ root WebApplicationContextì™€ Servlet WebApplicationContext ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.
rootëŠ” ëª¨ë“  servletì—ì„œ ê³µí†µìœ¼ë¡œ ê³µìœ í•  ìˆ˜ ìˆëŠ” Beanì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë³´í†µ dao ë‚˜ Repository,
ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë¹„ìŠ¤ì™€ ê°™ì´ ë‹¤ë¥¸ Servlet ê°ì²´ì—ì„œë„ í•„ìš”í•œ infrastructure ë¹ˆë“¤ì„ ë„£ìŠµë‹ˆë‹¤. root ê°€ ì—†ë‹¤ë©´ Servlet WebApplicationContext ê°€ rootì…ë‹ˆë‹¤.
WebApplicationContextëŠ” ServletContextë¥¼ ì¡°í•©ìœ¼ë¡œ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” Servlet Containerì™€ ì—°ê²°í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.

**Servlet Contextì—ì„œ ê´€ë¦¬ ë˜ëŠ” Filterì™€ Springì´ ë§í¬ ë  ìˆ˜ ìˆì—ˆë˜ ì´ìœ ì…ë‹ˆë‹¤. WebApplicationContext ê°€ ServletContextë¥¼ ê°–ê³  ìˆì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.** 

- ì°¸ê³  
    - [ì„œë¸”ë¦¿ê³¼ ìŠ¤í”„ë§ì—ì„œ Context(ì»¨í…ìŠ¤íŠ¸)ë€?](https://linked2ev.github.io/spring/2019/09/15/Spring-5-ì„œë¸”ë¦¿ê³¼-ìŠ¤í”„ë§ì—ì„œ-Context(ì»¨í…ìŠ¤íŠ¸)ë€/)
    - [stackoverflow](https://stackoverflow.com/questions/31931848/applicationcontext-and-servletcontext)

### Authentication, Authorization

ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ ë¬¸ì œëŠ” ë³´í†µ ëŒ€ì²´ë¡œ Authentication(who are you?) ì™€ Authorization(what are you allowed to do?) ì •ë„ë¡œ ìš”ì•½ë©ë‹ˆë‹¤.
> Spring Security has an architecture that is designed to separate authentication from authorization

Spring Security ëŠ” authentication ì™€ authorization ì„ ë¶„ë¦¬í•´ ë””ìì¸í•˜ì˜€ìŠµë‹ˆë‹¤.

#### Authentication Flow
![authentication_flow](images/authentication_flow.png)
ëŒ€ëµì ì¸ ì¸ì¦ í”Œë¡œìš°ëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ìš”ì²­ì´ ì™”ì„ë•Œ HttpSessionì—ì„œ ì‚¬ìš©ì ì¸ì¦ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  SecurityContext ì €ì¥í•´ì„œ ì „ë‹¬í•©ë‹ˆë‹¤.
ìš”ì²­ì´ ëë‚˜ë©´ ì›ë˜ ê¸°ì¡´ì— ì‚¬ìš©ëœ SecurityContextì—ì„œ ë³€ê²½ëœ ì •ë³´ë¥¼ ì›ë˜ ì½ì–´ì™”ë˜ ê³³ìœ¼ë¡œ ì €ì¥í•˜ê³  SecurityContextë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

httpSessionì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ HttpSessionì—ì„œ ì¡°íšŒí•™ê³  ì €ì¥í•˜ëŠ” ê³¼ì •ì´ ì—†ê² ì£ ?

#### Authentication Architecture
![authentication_architecture](images/authentication_architecture.png)

##### AuthenticationManager
![](images/AuthenticationManager.png)
AuthenticationManagerëŠ” ì–´ë–»ê²Œ Spring Securityì˜ í•„í„°ê°€ Authenticationì„ ìˆ˜í–‰í• ì§€ ì •ì˜í•´ë‘” API ì…ë‹ˆë‹¤.

```java
public interface AuthenticationManager {

  Authentication authenticate(Authentication authentication)
    throws AuthenticationException;

}
```
AuthenticationManagerì˜ authenticate()ëŠ” 3ê°€ì§€ì¤‘ í•œê°€ì§€ë¥¼ returní•©ë‹ˆë‹¤

1. return an Authentication (normally with authenticated=true) if it can verify that the input represents a valid principal.

2. throw an AuthenticationException if it believes that the input represents an invalid principal.

3. return null if it canâ€™t decide.

AuthenticationExceptionì€ Runtime Exceptionì…ë‹ˆë‹¤. í•´ë‹¹ Exceptionì€ ìœ ì € ì½”ë“œì—ì„œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•œë‹¤ê³  ìƒê°í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— 
ë³´í†µ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì˜í•´ ì›¹ UIëŠ” ì¸ì¦ì´ ì‹¤íŒ¨í–ˆë‹¤ëŠ” í˜ì´ì§€ë¥¼ ë Œë”ë§í•˜ê³  ë°±ì—”ë“œ HTTP ì„œë¹„ìŠ¤ëŠ” ì»¨í…ìŠ¤íŠ¸ì— ë”°ë¼ WWW-Authenticate í—¤ë”ê°€ ìˆë“  ì—†ë“  401 ì‘ë‹µì„ ì „ì†¡í•©ë‹ˆë‹¤.

##### ProviderManager
AuthenticationManagerì˜ ê°€ì¥ ì¼ë°˜ì ì¸ êµ¬í˜„ì²´ë¡œ ìŠ¤í”„ë§ì—ì„œ ì¸ì¦ì„ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
(Spring Securityê°€ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” ë¹ˆì´ê¸°ë•Œë¬¸ì— ë”°ë¡œ êµ¬í˜„í•´ì¤„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.)
í•˜ì§€ë§Œ ì§ì ‘ ì¸ì¦ ê³¼ì •ì„ ì§„í–‰í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ë©¤ë²„ ë³€ìˆ˜ë¡œ ê°€ì§€ê³  ìˆëŠ” `private List<AuthenticationProvider> providers;`
ë“¤ì„ì—ê²Œ support()ë¡œ ì¸ì¦ê°€ëŠ¥í•œì§€ ë¬»ê³  ê°€ëŠ¥í•˜ë©´ ì¸ì¦ì„ ìœ„ì„ì²˜ë¦¬í•˜ê³  ê·¸ ì¤‘ì— í•˜ë‚˜ì˜ AuthenticationProvider(ëª…í™•í•˜ê²ŒëŠ” AuthenticationProviderë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤)ê°ì²´ê°€ ì¸ì¦ ê³¼ì •ì„ ê±°ì³ì„œ ì¸ì¦ì— ì„±ê³µí•˜ë©´ ìš”ì²­ì— ëŒ€í•´ì„œ
ProviderManagerê°€ ì¸ì¦ì´ ë˜ì—ˆë‹¤ê³  ì•Œë ¤ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì¦‰ ê°™ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ë„ ì¸ì¦ë°©ë²•ì„ ì—¬ëŸ¬ê°€ì§€ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ê°–ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¸ì¦ì´ ë˜ì—ˆë‹¤ê³  ì•Œë ¤ì£¼ëŠ” ê±´ AuthenticationManager ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œì¸ authenticate() ë©”ì„œë“œì˜ ë¦¬í„´ ê°’ì¸ Authenticationê°ì²´ ì•ˆì— ì¸ì¦ ê°’ì„ ë„£ì–´ì£¼ëŠ” ê²ƒìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
```java
public interface AuthenticationProvider {
	Authentication authenticate(Authentication authentication)
			throws AuthenticationException;

	boolean supports(Class<?> authentication);
}
```
parent provider ë¥¼ Optional í•˜ê²Œ ê°–ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.ëª¨ë“  ë“±ë¡ëœ List ë¡œ ë“±ë¡ëœ í”„ë¡œë°”ì´ë”ê°€ support() í• ê²Œ ì—†ë‹¤ë©´ parent providerë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
![AuthenticationManager_hierarchy](images/AuthenticationManager_hierarchy.png)
ëª¨ë“  providerê°€ ì‹¤íŒ¨í–ˆì„ë•Œ parantê°€ ì¡´ì¬í•œë‹¤ë©´ parantë¥¼ ì‹¤í–‰íˆí‚¤ê³  ì´ë§ˆì €ë„ ì‹¤íŒ¨í•œë‹¤ë©´ Exceptionì„ í„°íŠ¸ë¦½ë‹ˆë‹¤.  
íŠ¹ì • providerì˜ ì˜ˆë¹„ì—­í• ë¡œ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

AuthenticationManagerë¥¼ ì»¤ìŠ¤í…€ í•˜ê¸° ìœ„í•´ì„  global Authenticationì„ í•´ì£¼ë ¤ë©´ @Autowiredë¥¼
@Overrideë¥¼ í•´ì£¼ë©´ local Authentication

Spring boot ì—ì„œ ì„¤ì •í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë””í´íŠ¸ global AuthenticationProvider(parent)ë¥¼ ì œê³µí•œë‹¤.
parent ê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´ **ë‹¹ì‹ ì´ ê·¸ê²ƒì— ëŒ€í•´ í¬ê²Œ ê±±ì •í•  í•„ìš”ê°€ ì—†ì„ ë§Œí¼ ì¶©ë¶„íˆ ì•ˆì „í•˜ë‹¤.** ë¼ê³  ë˜í¼ëŸ°ìŠ¤ì— ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.


![](images/DI_provider.png)
DaoAuthenticationProviderì—ì„œëŠ” UserDetailsServiceë¥¼ ì£¼ì… ë°›ì•„ ë¹„ë°€ë²ˆí˜¸ ëŒ€ì¡° ë° íšŒì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. 
ì—¬ê¸°ì„œë„ DIì˜ ìœ„ëŒ€í•¨ì„ ë³¼ ìˆ˜ ìˆë‹¤.

**ProviderManager.java** ì˜ authenticate(Authenticate )ë¥¼ ë³´ë©´ íë¦„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



### Filter ê¸°ë°˜ì˜ Spring Security(JwtAuthenticationToken)
Spring SecurityëŠ” Filter ê¸°ë°˜ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ Filterë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì´ìœ ë¡œëŠ” í”„ë ˆì„ì›Œí¬ ì˜ì¡´ì„±ì„ ì—†ì• ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ Spring MVCì™€ ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ ê´€ë¦¬ ë° ë™ì‘í•©ë‹ˆë‹¤.

ì²˜ìŒì— JWTë¥¼ ì‚¬ìš©í–ˆë˜ ìš°ë¦¬ íŒ€ì˜ ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ëŠ” dispatcher Servletì„ ë„˜ì–´ì™€ Interceptorì—ì„œ ìš”ì²­ì„ ê°€ë¡œì±„ tokenì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•˜ëŠ” í˜•íƒœì˜€ìŠµë‹ˆë‹¤.

application contextê°€ ì•„ë‹Œ Spring contextì—ì„œ ìš”ì²­ì— ëŒ€í•´ ìœ íš¨ì„±ì„ íŒë‹¨í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

ì €ëŠ” ì´ëŸ° í˜•íƒœê°€ ë§ì§€ ì•ŠëŠ”ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. Spring MVCì™€ ë¶„ë¦¬ë˜ì–´ ë™ì‘í•˜ëŠ” Securityë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ Filterì—ì„œ ì¸ì¦ê³¼ ì¸ê°€ë¥¼ ì²˜ë¦¬í•˜ëŠ”ë° ê·¸ í›„ ë‹¤ì‹œ Spring MVCì˜
Interceptì—ì„œ í† í°ì˜ ìœ íš¨ì„± ê²€ì‚¬í•´ ë˜ ì¸ì¦ ì¸ê°€ë¥¼ í•œ ë²ˆ ë” ì²˜ë¦¬í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì´ìƒí•˜ê²Œ ëŠê»´ì¡ŒìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ Filterì—ì„œ ì¸ì¦, ì¸ê°€ë¥¼ ì²˜ë¦¬í•˜ê¸° ì§ì „ì— í† í° ìœ íš¨ì„±ì„ íŒë‹¨í•´ ì˜ëª»ëœ ìš”ì²­ì´ë¼ë©´ Exceptionì„ í„°íŠ¸ë ¤ ê·¸ ì´í›„ í•„í„°ë¥¼ ê±°ì¹˜ì§€ ì•Šë„ë¡ ë°”ê¿”ì•¼ ìƒê°ì„ í–ˆê³ 

ë”°ë¼ì„œ JwtAuthenticationFilter ëŠ˜ ë§Œë“¤ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.

- ì°¸ê³ 
    - [(Spring)Filterì™€ Interceptorì˜ ì°¨ì´](https://meetup.toast.com/posts/151)
    - [Springì˜ Filter ì™€ Interceptor ì— ëŒ€í•˜ì—¬](https://jins-dev.tistory.com/entry/Springì˜-Filter-ì™€-Interceptor-ì—-ëŒ€í•˜ì—¬)
    - [ApplicationContext](https://hoonmaro.tistory.com/31)


# Level 4
## ë„ë©”ì¸
![Lv4ë„ë©”ì¸](images/Lv4_domain.png)
### ì¶”ê°€ëœ ë„ë©”ì¸
![Lv4ë„ë©”ì¸](images/Lv4_additional_domain.png)
